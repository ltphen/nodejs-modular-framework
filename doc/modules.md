# Modules folder API

the project modules. It contain every modules of the project. Ex : `Account, Forum, Shared, Core, ...`

There is a shared folder that contain shared functions that everycontroller can use easily to facilitate some task or to communicate.
This module contain a generic controller with some helpful method as 


    usage : method(data, database)
    - insert
    - update
    - delete
    - getAll
    - getWhere

- 

```
.
+-- moduleName
|   +-- controller
|   +-- model
|   +-- middlewares
|   +-- routing
|   +-- main
	
```

## Controller folder

### explain

Different module's controllers. 
controllers can be generate with the [cli](cli.md)

### Usage

Controller specimen
```
controllerAccount.prototype.updateProfile  =  function(data, fn) {

var  self  =  this;

// validate data

this.model.updateProfile(data).then(function(data){
// positive response
self.parent.addStatus(data, fn);

}).catch(function(error){

console.log(error);
// bad response
self.parent.badStatus(fn);

});

};
```

self.parent is an Instance of the controlle Parent . Explained [here](generic.md)
   
  

## Model folder

### explain

Different module's models. 
models can be generate with the [cli](cli.md)

### Usage

Model specimen
```
modelAccount.prototype.updateProfile  =  function(data) {
// retreive id from data and remove the id property in data
return  this.parent.database.knex('users').update(data).where({id :  id});

};
```

this.parent is an Instance of the model Parent . Explained [here](generic.md)
    


## Middleware folder

### explain

Different module's middlewares. 
middlewares can be generate with the [cli](cli.md)

### Usage

Middleware specimen
```
/**

* @params params Type description

*/

  

middlewareAuth.prototype.authentificate  =  function() {

let  self  =  this;

  

return  function(req, res, next){

  
// retreive token from header
var  token  =  self.controller.getToken(req);

  

if (token  !=  null) {

try {

var  decoded  =  self.jwt.verify(token, self.config.get("jwt.secret"));

req.decodedToken  =  decoded.data;

next();

} catch(error) {

console.log(error);

res.status(401).send('User Not Authenticated');

}

}else{

res.status(403).send('User must be authentificated to access the ressource');

}

  

}

  

// var jwt = require('express-jwt');

// return jwt({ secret: this.config.get("jwt.secret")});

}
```

middleware parent are explained [here](generic.md)
    
    


## Routing folder

### explain

Here we find all the api routes of the module

The unique point that help the middleware to communicate with external ressources

**NB** : autogenerated when generating the module


### Usage

Route specimen
```
this.app.post("/updateProfile", function(request, response){
this.controller  =  this.module.controller.getInstanceOf("account");

self.controller.updateProfile(request.body.name, request.body.mail, request.body.sex, request.body.pseudo, request.body.image, request.body.password, request.body.id_user, function(result){

response.send(result);

});

});
```

These routes are accessible elsewhere by the `module.getRoutes()` method    

## Main folder

### explain

It help the module to access to it ressouces . Every controller , model, middleware, routing class need it to access to others module ressources

It help the module elements to communicate between them and also with the shared

**NB** : autogenerated when generating the module




